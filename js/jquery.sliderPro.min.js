// jQuery Slider Pro Plugin
(function($) {
    'use strict';

    $.fn.sliderPro = function(options) {
        var settings = $.extend({
            width: 1200,
            height: 500,
            autoplay: true,
            autoplayOnHover: 'pause',
            autoplayDelay: 5000,
            arrows: true,
            buttons: true,
            smallSize: 500,
            mediumSize: 1000,
            largeSize: 3000,
            fade: true,
            thumbnailArrows: true,
            thumbnailWidth: 10,
            thumbnailHeight: 10,
            thumbnailsPosition: 'bottom',
            centerImage: true,
            imageScaleMode: 'cover',
            allowScaleUp: true,
            startSlide: 0,
            loop: true,
            slideDistance: 5,
            autoplayDirection: 'normal',
            touchSwipe: true,
            fullScreen: true
        }, options);

        return this.each(function() {
            var $slider = $(this);
            var $slides = $slider.find('.sp-slides');
            var $slideElements = $slides.find('.sp-slide');
            var currentSlide = settings.startSlide;
            var totalSlides = $slideElements.length;
            var autoplayTimer;
            var isTransitioning = false;

            // Initialize slider
            function init() {
                // Set slider dimensions
                $slider.css({
                    width: settings.width,
                    height: settings.height
                });

                // Set initial slide
                $slideElements.hide();
                $slideElements.eq(currentSlide).show().addClass('sp-selected');

                // Create navigation arrows
                if (settings.arrows && totalSlides > 1) {
                    createArrows();
                }

                // Create navigation buttons
                if (settings.buttons && totalSlides > 1) {
                    createButtons();
                }

                // Create fullscreen button
                if (settings.fullScreen) {
                    createFullscreenButton();
                }

                // Start autoplay
                if (settings.autoplay && totalSlides > 1) {
                    startAutoplay();
                }

                // Initialize touch swipe
                if (settings.touchSwipe) {
                    initTouchSwipe();
                }

                // Handle hover events
                if (settings.autoplayOnHover === 'pause') {
                    $slider.hover(
                        function() { stopAutoplay(); },
                        function() { if (settings.autoplay) startAutoplay(); }
                    );
                }
            }

            // Create navigation arrows
            function createArrows() {
                var $arrows = $('<div class="sp-arrows"></div>');
                var $prevArrow = $('<button class="sp-arrow sp-previous-arrow"><i class="fa fa-chevron-left"></i></button>');
                var $nextArrow = $('<button class="sp-arrow sp-next-arrow"><i class="fa fa-chevron-right"></i></button>');

                $arrows.append($prevArrow).append($nextArrow);
                $slider.append($arrows);

                $prevArrow.click(function() {
                    goToSlide('prev');
                });

                $nextArrow.click(function() {
                    goToSlide('next');
                });
            }

            // Create navigation buttons
            function createButtons() {
                var $buttons = $('<div class="sp-buttons"></div>');
                
                for (var i = 0; i < totalSlides; i++) {
                    var $button = $('<button class="sp-button"></button>');
                    if (i === currentSlide) {
                        $button.addClass('sp-selected-button');
                    }
                    $button.click(function(index) {
                        return function() {
                            goToSlide(index);
                        };
                    }(i));
                    $buttons.append($button);
                }

                $slider.append($buttons);
            }

            // Create fullscreen button
            function createFullscreenButton() {
                var $fullscreenBtn = $('<button class="sp-full-screen-button"><i class="fa fa-expand"></i></button>');
                $slider.append($fullscreenBtn);

                $fullscreenBtn.click(function() {
                    if (!document.fullscreenElement) {
                        $slider[0].requestFullscreen();
                        $(this).find('i').removeClass('fa-expand').addClass('fa-compress');
                    } else {
                        document.exitFullscreen();
                        $(this).find('i').removeClass('fa-compress').addClass('fa-expand');
                    }
                });
            }

            // Go to specific slide
            function goToSlide(slide) {
                if (isTransitioning) return;

                var targetSlide;
                if (typeof slide === 'string') {
                    if (slide === 'next') {
                        targetSlide = currentSlide + 1;
                        if (targetSlide >= totalSlides) {
                            targetSlide = settings.loop ? 0 : totalSlides - 1;
                        }
                    } else if (slide === 'prev') {
                        targetSlide = currentSlide - 1;
                        if (targetSlide < 0) {
                            targetSlide = settings.loop ? totalSlides - 1 : 0;
                        }
                    }
                } else {
                    targetSlide = slide;
                }

                if (targetSlide === currentSlide) return;

                isTransitioning = true;

                // Hide current slide
                $slideElements.eq(currentSlide).hide().removeClass('sp-selected');

                // Show target slide
                $slideElements.eq(targetSlide).show().addClass('sp-selected');

                // Update buttons
                $slider.find('.sp-button').removeClass('sp-selected-button');
                $slider.find('.sp-button').eq(targetSlide).addClass('sp-selected-button');

                currentSlide = targetSlide;
                isTransitioning = false;
            }

            // Start autoplay
            function startAutoplay() {
                stopAutoplay();
                autoplayTimer = setInterval(function() {
                    goToSlide('next');
                }, settings.autoplayDelay);
            }

            // Stop autoplay
            function stopAutoplay() {
                if (autoplayTimer) {
                    clearInterval(autoplayTimer);
                    autoplayTimer = null;
                }
            }

            // Initialize touch swipe
            function initTouchSwipe() {
                var touchStartX = 0;
                var touchEndX = 0;
                var touchStartY = 0;
                var touchEndY = 0;

                $slider.on('touchstart', function(e) {
                    touchStartX = e.originalEvent.touches[0].clientX;
                    touchStartY = e.originalEvent.touches[0].clientY;
                    $slider.addClass('sp-grab');
                });

                $slider.on('touchend', function(e) {
                    touchEndX = e.originalEvent.changedTouches[0].clientX;
                    touchEndY = e.originalEvent.changedTouches[0].clientY;
                    $slider.removeClass('sp-grab');

                    var deltaX = touchEndX - touchStartX;
                    var deltaY = touchEndY - touchStartY;

                    // Check if it's a horizontal swipe
                    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                        if (deltaX > 0) {
                            goToSlide('prev');
                        } else {
                            goToSlide('next');
                        }
                    }
                });
            }

            // Initialize the slider
            init();
        });
    };

}(jQuery));